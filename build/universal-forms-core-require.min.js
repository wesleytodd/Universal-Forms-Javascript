define(function(){var t=function(e,i,r,s){if(!(this instanceof t))return new t(e,i,r,s);if("string"!=typeof e)throw new TypeError("A name is required for all fields");if("string"!=typeof i)throw new TypeError("A type is required for all fields");if("object"!=typeof r&&(r={}),r.rules===void 0)r.rules=[];else if(!(r.rules instanceof Array))throw new TypeError("the rules must be defined as an array");if(r.attributes=r.attributes||{},r.attributes.name=e,r.attributes.id=r.id||"",-1===["textarea","select"].indexOf(i)&&(r.attributes.type=i,r.attributes.value=r.value||""),this.name=e,this.type=i,this.value=r.value||"",this.label=r.label,this.attributes=r.attributes,this.rules=r.rules,this.fieldJSON=r,this.errors={},-1!==["select","radio","checkbox"].indexOf(this.type)&&(this.options=r.options),this.opts={},t.defaultOpts!==void 0)for(var o in t.defaultOpts)this.opts[o]=t.defaultOpts[o];if(s!==void 0)for(var o in s)this.opts[o]=s[o];t.trigger(this,"init")};t.prototype.setError=function(e,i){this.errors[e]=i,t.trigger(this,"setError")},t.prototype.clearError=function(e){return this.errors[e]!==void 0?delete this.errors[e]:(e===void 0&&(this.errors={}),t.trigger(this,"clearError"),void 0)},t.prototype.serialize=function(t){var e={name:this.name,type:this.type,value:this.value,label:this.label,rules:this.rules,errors:this.errors};return-1!==["select","radio","checkbox"].indexOf(this.type)&&(e.options=this.options),t=t!==void 0?t:!1,t?JSON.stringify(e):e},t.on=function(e,i){t._hooks===void 0&&(t._hooks={}),t._hooks[e]===void 0&&(t._hooks[e]=[]),t._hooks[e].push(i)},t.trigger=function(e,i){if(void 0!==t._hooks&&"undefined"!==t._hooks[i])for(var r=0,s=t._hooks[i].length;s>r;r++)t._hooks[i][r].apply(e,Array.prototype.slice.call(arguments,2))};var e=function(t,i){if(!(this instanceof e))return new e(t,i);if(t===void 0&&(t={}),t.attributes=t.attributes||{},t.attributes.id=t.id,t.attributes.method=t.method||"POST",t.attributes.action=t.action,this.attributes=t.attributes,this.fields={},this.formJSON=t,t.fields===void 0)t.fields=[];else if(!(t.fields instanceof Array))throw new TypeError("Fields must be defined as an array");for(var r=t.fields.length,s=0;r>s;s++)this.addField(t.fields[s].name,t.fields[s].type,t.fields[s]);if(this.opts={},e.defaultOpts!==void 0)for(var o in e.defaultOpts)this.opts[o]=e.defaultOpts[o];if(i!==void 0)for(var o in i)this.opts[o]=i[o];e.trigger(this,"init")};return e.prototype.addField=function(e,i,r,s){return e instanceof t?this.fields[e.name]=e:this.fields[e]=new t(e,i,r,s)},e.prototype.removeField=function(t){this.fields[t]!==void 0&&delete this.fields[t],e.trigger(this,"removeField")},e.prototype.eachField=function(t,e){for(var i in this.fields)if(t.call(e||this,this.fields[i],i,this.fields)===!1)break},e.on=function(t,i){e._hooks===void 0&&(e._hooks={}),e._hooks[t]===void 0&&(e._hooks[t]=[]),e._hooks[t].push(i)},e.trigger=function(t,i){if(void 0!==e._hooks&&"undefined"!==e._hooks[i])for(var r=0,s=e._hooks[i].length;s>r;r++)e._hooks[i][r].apply(t,Array.prototype.slice.call(arguments,2))},{Form:e,Field:t}});